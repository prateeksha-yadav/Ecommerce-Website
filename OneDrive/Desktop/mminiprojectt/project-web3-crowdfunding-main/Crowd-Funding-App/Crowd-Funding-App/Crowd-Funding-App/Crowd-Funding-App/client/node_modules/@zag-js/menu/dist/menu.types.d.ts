import { StateMachine, Machine } from '@zag-js/core';
import { PositioningOptions } from '@zag-js/popper';
import { Point } from '@zag-js/rect-utils';
import { RequiredBy, DirectionProperty, CommonProperties, Context } from '@zag-js/types';

type ElementIds = Partial<{
    trigger: string;
    contextTrigger: string;
    content: string;
    label(id: string): string;
    group(id: string): string;
}>;
type PublicContext = DirectionProperty & CommonProperties & {
    /**
     * The ids of the elements in the menu. Useful for composition.
     */
    ids?: ElementIds;
    /**
     * The values of radios and checkboxes in the menu.
     */
    value?: Record<string, string | string[]>;
    /**
     * Callback to be called when the menu values change (for radios and checkboxes).
     */
    onValueChange?: (details: {
        name: string;
        value: string | string[];
    }) => void;
    /**
     * The `id` of the active menu item.
     */
    highlightedId: string | null;
    /**
     * Function called when a menu item is selected.
     */
    onSelect?: (details: {
        value: string;
    }) => void;
    /**
     * The positioning point for the menu. Can be set by the context menu trigger or the button trigger.
     */
    anchorPoint: Point | null;
    /**
     * Whether to loop the keyboard navigation.
     */
    loop: boolean;
    /**
     * The options used to dynamically position the menu
     */
    positioning: PositioningOptions;
    /**
     * Whether to close the menu when an option is selected
     */
    closeOnSelect: boolean;
    /**
     * The accessibility label for the menu
     */
    "aria-label"?: string;
    /**
     * Function called when the menu is opened
     */
    onOpen?: () => void;
    /**
     * Function called when the menu is closed
     */
    onClose?: () => void;
};
type UserDefinedContext = RequiredBy<PublicContext, "id">;
type ComputedContext = Readonly<{
    /**
     * @computed
     * Whether the menu is a submenu (has a parent menu)
     */
    readonly isSubmenu: boolean;
    /**
     * @computed
     * Whether the writing direction is rtl
     */
    readonly isRtl: boolean;
    /**
     * @computed
     * Whether a typeahead search is ongoing
     */
    readonly isTypingAhead: boolean;
}>;
type PrivateContext = Context<{}>;
type MachineContext = PublicContext & PrivateContext & ComputedContext;
type MachineState = {
    value: "unknown" | "idle" | "open" | "closed" | "opening" | "closing" | "opening:contextmenu";
    tags: "visible";
};
type State = StateMachine.State<MachineContext, MachineState>;
type Send = StateMachine.Send<StateMachine.AnyEventObject>;
type Service = Machine<MachineContext, MachineState>;
type Api = {
    getItemProps: (opts: ItemProps) => Record<string, any>;
    triggerProps: Record<string, any>;
};
type ItemProps = {
    /**
     * The `id` of the menu item option.
     */
    id: string;
    /**
     * Whether the menu item is disabled
     */
    disabled?: boolean;
    /**
     * The textual value of the option. Used in typeahead navigation of the menu.
     * If not provided, the text content of the menu item will be used.
     */
    valueText?: string;
    /**
     * Whether the menu should be closed when the option is selected.
     */
    closeOnSelect?: boolean;
};
type OptionItemProps = Partial<ItemProps> & {
    /**
     * The option's name as specified in menu's `context.values` object
     */
    name: string;
    /**
     * Whether the option is a radio or a checkbox
     */
    type: "radio" | "checkbox";
    /**
     * The value of the option
     */
    value: string;
    /**
     * Function called when the option state is changed
     */
    onCheckedChange?: (checked: boolean) => void;
};
type GroupProps = {
    /**
     * The `id` of the element that provides accessibility label to the option group
     */
    id: string;
};
type LabelProps = {
    /**
     * The `id` of the group this refers to
     */
    htmlFor: string;
};

export { Api, GroupProps, ItemProps, LabelProps, MachineContext, MachineState, OptionItemProps, Send, Service, State, UserDefinedContext };
